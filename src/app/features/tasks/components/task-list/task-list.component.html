<main class="px-10">
  <div class="flex justify-end mt-5">
    <span
      class="text-xl font-medium bg-[#cb075a] text-white px-5 py-2 rounded-md hover:cursor-pointer"
      (click)="createTaskDialog()"
    >
      Add Task
    </span>
  </div>
  <div class="flex justify-between items-center gap-3 flex-wrap mt-5">
    <!-- search -->
    <mat-form-field>
      <mat-label>Search</mat-label>
      <input matInput [(ngModel)]="keyword" (keyup)="getAllTasks()" />
    </mat-form-field>
    <!-- by user -->
    <mat-form-field>
      <mat-label>By user</mat-label>
      <mat-select [(value)]="userId" (valueChange)="getAllTasks()">
        <mat-option value="">All</mat-option>
        <mat-option [value]="user._id" *ngFor="let user of users$ | async">
          {{ user.username }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <!-- status -->
    <mat-form-field>
      <mat-label>Status</mat-label>
      <mat-select [(value)]="status" (valueChange)="getAllTasks()">
        <mat-option value="">All</mat-option>
        <mat-option value="In-Progress">In-Progress</mat-option>
        <mat-option value="Complete">Complete</mat-option>
        <mat-option value="Canceled">Canceled</mat-option>
      </mat-select>
    </mat-form-field>
    <!-- date range -->
    <div>
      <mat-form-field>
        <mat-label>Enter a date range</mat-label>
        <mat-date-range-input [rangePicker]="picker" [formGroup]="range">
          <input
            matStartDate
            placeholder="Start date"
            formControlName="start"
          />
          <input
            matEndDate
            placeholder="End date"
            formControlName="end"
            (dateChange)="getAllTasks()"
          />
        </mat-date-range-input>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>
      <button mat-icon-button (click)="resetDate()" class="">
        <mat-icon>autorenew</mat-icon>
      </button>
    </div>
  </div>
  <!-- table -->
  <div class="table-container">
    <!-- if data retrived -->
    <div
      class="flex justify-between items-center gap-2 p-5 bg-[#cb075a] text-white"
    >
      <span class="w-[5%]">No.</span>
      <!-- <span class="w-[10%]">Image</span> -->
      <span class="w-[25%]">Title</span>
      <span class="w-[20%]">User</span>
      <span class="w-[15%]">DeadLine</span>
      <span class="w-[15%]">Status</span>
      <span class="w-[25%]"></span>
    </div>
    <div class="row-style" *ngFor="let task of tasksToView; index as index">
      <span class="w-[5%]">{{ firstRowPosition + index }}</span>
      <!-- <span class="w-[10%]">
          <img [src]="'https://crud-5swn.onrender.com/' + task.image" alt="img" />
        </span> -->
      <span class="w-[25%]">{{ task.title }}</span>
      <span class="w-[20%]">{{ task.userId.username }}</span>
      <span class="w-[15%]">
        {{ task.deadline | date : "shortDate" }}
      </span>
      <span class="w-[15%]">{{ task.status }}</span>
      <span class="w-[25%] flex gap-3">
        <span class="btn-update" (click)="updateTaskDialog(task)">
          Update
        </span>
        <span class="btn-delete" (click)="removeTaskDialog(task._id)">
          Delete
        </span>
      </span>
    </div>
  </div>
  <!-- if loading -->
  <div class="text-center" *ngIf="isLoading">
    <app-spinner1></app-spinner1>
  </div>
  <!-- if no data -->
  <div
    class="text-center py-3 text-[#b1b0b2]"
    *ngIf="!isLoading && tasksToView.length === 0"
  >
    No data
  </div>
  <!-- paginator of table -->
  <app-task-list-paginator></app-task-list-paginator>
</main>
